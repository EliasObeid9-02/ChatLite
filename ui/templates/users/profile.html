{% extends is_htmx_request|yesno:"_base.html,base.html" %}

{% block layout %}
<main class="centered-layout">
    <div class="auth-card">
        <h2>{{ profile.display_name|default:profile.user.username }}'s Profile</h2>
        <div style="text-align: center; margin-bottom: 2rem;">
            {% if profile.profile_picture %}
                <img src="{{ profile.profile_picture }}" alt="Profile Picture" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;">
            {% endif %}
        </div>

        {% if is_owner %}
            <form
                hx-post="{% url 'users:profile' user_id=profile.user.id %}"
                hx-encoding="multipart/form-data"
                enctype="multipart/form-data"
                hx-target="#content"
                hx-swap="innerHTML"
            >
                {% csrf_token %}

                {% if form.non_field_errors %}
                <div class="form-errors" style="color: #ff4d4d; text-align: center; margin-bottom: 1rem;">
                    {% for error in form.non_field_errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="form-group">
                    <label for="{{ form.display_name.id_for_label }}">Display Name</label>
                    {{ form.display_name }}
                    {% if form.display_name.errors %}
                    <div style="color: #ff4d4d; font-size: 0.8rem; margin-top: 0.25rem;">
                        {{ form.display_name.errors.0 }}
                    </div>
                    {% endif %}
                    <small class="helper-text">Update your public display name.</small>
                </div>
                <div class="form-group">
                    <label for="{{ form.profile_picture_file.id_for_label }}">Upload New Picture</label>
                    {{ form.profile_picture_file }}
                    {% if form.profile_picture_file.errors %}
                    <div style="color: #ff4d4d; font-size: 0.8rem; margin-top: 0.25rem;">
                        {{ form.profile_picture_file.errors.0 }}
                    </div>
                    {% endif %}
                </div>
                <button type="submit" class="btn">Save Changes</button>
            </form>
        {% else %}
            {% endif %}
    </div>
</main>
{% endblock %}
